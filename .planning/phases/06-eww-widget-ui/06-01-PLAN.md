---
phase: 06-eww-widget-ui
plan: 01
type: execute
domain: eww
---

<objective>
Set up EWW widget infrastructure with base configuration, IPC scripts, and Hyprland blur integration.

Purpose: Establish the foundation for HyFocus widgets - directory structure, styling variables, communication scripts, and compositor blur rules.
Output: Working EWW daemon with glass-style blur enabled, ready for widget development.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-eww-widget-ui/06-RESEARCH.md

**Key patterns from research:**
- Multiple `defwindow` definitions for independent blur control
- Hyprland `layerrule = blur, <namespace>` for glass effect
- `deflisten` with socat for real-time Hyprland events
- `defpoll` for periodic HyFocus status updates

**HyFocus dispatcher interface:**
- `hyprctl dispatch hyfocus:start [workspaces]` - Start session
- `hyprctl dispatch hyfocus:stop` - Stop session
- `hyprctl dispatch hyfocus:status` - Get status (notification output)
- `hyprctl dispatch hyfocus:pause` / `hyfocus:resume` - Pause/resume
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EWW directory structure and base configuration</name>
  <files>eww/eww.yuck, eww/eww.scss, eww/styles/_variables.scss, eww/styles/_glass.scss</files>
  <action>
Create EWW configuration directory structure at project root:

```
eww/
├── eww.yuck           # Main config with includes
├── eww.scss           # Main styles with imports
├── windows/           # Window definitions (empty for now)
├── widgets/           # Widget components (empty for now)
├── styles/
│   ├── _variables.scss   # Color palette, sizing, fonts
│   └── _glass.scss       # Glass effect base styles
└── scripts/           # IPC scripts (next task)
```

**eww.yuck:**
- Use `(include "path")` for modular organization
- Define shared variables: `hyfocus-active` (bool), `hyfocus-state` (string), `hyfocus-remaining` (string)
- Include placeholder for windows (will be added in later plans)

**eww.scss:**
- Import variables and glass styles
- Reset all styles with `* { all: unset; }`
- Define base font (system monospace or JetBrains Mono if available)

**_variables.scss:**
- Catppuccin Mocha color palette (matches common Hyprland themes)
- Glass opacity: 0.75
- Border radius: 12px
- Padding: 8px, 12px, 16px scales
- Font sizes: 12px, 14px, 18px

**_glass.scss:**
- `.glass-panel` class with semi-transparent background, subtle border, border-radius
- Background: rgba($base, 0.75) where $base is dark color
- Border: 1px solid rgba(white, 0.08)

Do NOT use backdrop-filter (GTK doesn't support it - blur comes from Hyprland layerrules).
  </action>
  <verify>
```bash
ls -la eww/
ls -la eww/styles/
cat eww/eww.yuck
cat eww/eww.scss
```
All files exist with valid syntax.
  </verify>
  <done>EWW directory structure created with eww.yuck, eww.scss, and style partials</done>
</task>

<task type="auto">
  <name>Task 2: Create IPC scripts and Hyprland configuration</name>
  <files>eww/scripts/hyfocus-status, eww/scripts/hyfocus-control, eww/hyprland-hyfocus.conf</files>
  <action>
**eww/scripts/hyfocus-status:**
Bash script that queries HyFocus status and outputs JSON for EWW consumption.

```bash
#!/bin/bash
# Query HyFocus plugin and parse notification output
# Output: {"active": bool, "state": "working|break|paused|inactive", "remaining": "MM:SS", "workspaces": [1,2,3]}
```

Since hyfocus:status outputs via notification (not stdout), we need a workaround:
- Check if session is active by testing g_fe_is_session_active state
- For now, use a simple approach: poll hyprctl and parse what we can
- Output JSON that EWW can consume with `literal` or `jq`

Make script executable (chmod +x).

**eww/scripts/hyfocus-control:**
Bash script wrapper for common HyFocus commands:
```bash
#!/bin/bash
# Usage: hyfocus-control start|stop|pause|resume|toggle [args]
case "$1" in
  start)  hyprctl dispatch hyfocus:start "$2" ;;
  stop)   hyprctl dispatch hyfocus:stop ;;
  pause)  hyprctl dispatch hyfocus:pause ;;
  resume) hyprctl dispatch hyfocus:resume ;;
  toggle) hyprctl dispatch hyfocus:toggle "$2" ;;
  *)      echo "Usage: hyfocus-control start|stop|pause|resume|toggle" ;;
esac
```

Make script executable (chmod +x).

**eww/hyprland-hyfocus.conf:**
Hyprland config snippet for users to include:
```conf
# HyFocus EWW Widget Configuration
# Add to hyprland.conf: source = ~/.config/hypr/hyfocus-eww.conf

# Blur for HyFocus widgets
layerrule = blur, hyfocus-status
layerrule = blur, hyfocus-start
layerrule = blur, hyfocus-warning

# Ignore transparent pixels (for rounded corners)
layerrule = ignorezero, hyfocus-status
layerrule = ignorezero, hyfocus-start
layerrule = ignorezero, hyfocus-warning

# Optional: prevent widgets from stealing focus
# layerrule = nofocus, hyfocus-status
```

Include comments explaining each rule.
  </action>
  <verify>
```bash
ls -la eww/scripts/
file eww/scripts/hyfocus-status
file eww/scripts/hyfocus-control
cat eww/hyprland-hyfocus.conf
# Check scripts are executable
test -x eww/scripts/hyfocus-status && echo "status script executable"
test -x eww/scripts/hyfocus-control && echo "control script executable"
```
  </verify>
  <done>IPC scripts created and executable, Hyprland config snippet ready</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>EWW infrastructure with directory structure, base styles, IPC scripts, and Hyprland layerrule configuration</what-built>
  <how-to-verify>
1. Check EWW is installed: `eww --version` (should show 0.6.x or similar)
2. Copy config to test location:
   ```bash
   mkdir -p ~/.config/eww-hyfocus-test
   cp -r eww/* ~/.config/eww-hyfocus-test/
   ```
3. Try starting EWW daemon:
   ```bash
   eww -c ~/.config/eww-hyfocus-test daemon
   eww -c ~/.config/eww-hyfocus-test ping
   ```
   Should respond "pong" if daemon is running.
4. Check scripts work:
   ```bash
   ~/.config/eww-hyfocus-test/scripts/hyfocus-status
   ```
   Should output JSON (even if HyFocus not running, should output inactive state).
5. Review hyprland-hyfocus.conf looks correct for your setup.

Note: Full blur verification will happen when we have visible widgets in plan 06-02.
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] eww/ directory exists with proper structure
- [ ] eww.yuck parses without errors (eww daemon starts)
- [ ] eww.scss compiles (no SCSS syntax errors)
- [ ] Scripts are executable and run without errors
- [ ] Hyprland config snippet has correct layerrule syntax
</verification>

<success_criteria>

- All tasks completed
- EWW daemon can start with the configuration
- Scripts execute without errors
- Ready for widget development in plan 06-02
</success_criteria>

<output>
After completion, create `.planning/phases/06-eww-widget-ui/06-01-SUMMARY.md`
</output>
