---
phase: 06-eww-widget-ui
plan: 03
type: execute
domain: eww
---

<objective>
Implement start panel widget for workspace selection and session configuration.

Purpose: Provide a user-friendly way to start focus sessions - select allowed workspaces, see blocking warnings, and launch with a single click.
Output: Centered modal panel with workspace selection, warning display, and start/cancel buttons.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-eww-widget-ui/06-RESEARCH.md
@eww/eww.yuck
@eww/eww.scss
@eww/scripts/hyfocus-control

**From 06-01 and 06-02:**
- EWW infrastructure in place
- Glass styling and status widget working
- IPC scripts for HyFocus control

**Start panel requirements:**
- Centered modal (overlay, focusable for interaction)
- Workspace selection (checkboxes or toggles for workspaces 1-10)
- Warning section explaining what will be blocked
- Start button (launches session with selected workspaces)
- Cancel button (closes panel)
- Glass aesthetic matching status indicator
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create start panel window and workspace selection</name>
  <files>eww/windows/start-panel.yuck, eww/widgets/start-panel-widget.yuck, eww/widgets/workspace-selector.yuck, eww/styles/start-panel.scss</files>
  <action>
**eww/windows/start-panel.yuck:**
Define centered modal window:
```yuck
(defwindow hyfocus-start
  :monitor 0
  :namespace "hyfocus-start"
  :geometry (geometry
    :x "50%"
    :y "50%"
    :width "380px"
    :height "auto"
    :anchor "center")
  :stacking "overlay"
  :exclusive false
  :focusable true
  (start-panel))
```

Key settings:
- `:focusable true` for button interaction
- `:anchor "center"` with 50% x/y for centered positioning
- `:height "auto"` to fit content

**eww/widgets/workspace-selector.yuck:**
Workspace toggle grid:
```yuck
; Track selected workspaces as comma-separated string
(defvar selected-workspaces "1")

(defwidget workspace-selector []
  (box :class "workspace-grid"
       :orientation "h"
       :space-evenly true
    (for ws in "[1, 2, 3, 4, 5]"
      (workspace-toggle :num ws))
    )
  (box :class "workspace-grid"
       :orientation "h"
       :space-evenly true
    (for ws in "[6, 7, 8, 9, 10]"
      (workspace-toggle :num ws))))

(defwidget workspace-toggle [num]
  (button :class "ws-btn ${matches(selected-workspaces, '${num}') ? 'selected' : ''}"
          :onclick "scripts/toggle-workspace ${num}"
    (label :text "${num}")))
```

**eww/scripts/toggle-workspace:**
Script to toggle workspace in selection:
```bash
#!/bin/bash
# Toggle workspace in EWW variable
WS="$1"
CURRENT=$(eww get selected-workspaces)

if echo "$CURRENT" | grep -qE "(^|,)$WS(,|$)"; then
  # Remove workspace
  NEW=$(echo "$CURRENT" | sed -E "s/(^|,)$WS(,|$)/\1/" | sed 's/^,//' | sed 's/,$//' | sed 's/,,/,/')
else
  # Add workspace
  if [ -z "$CURRENT" ]; then
    NEW="$WS"
  else
    NEW="$CURRENT,$WS"
  fi
fi

eww update selected-workspaces="$NEW"
```

Make executable.

**eww/widgets/start-panel-widget.yuck:**
Main panel layout:
```yuck
(defwidget start-panel []
  (box :class "glass-panel start-panel"
       :orientation "v"
       :space-evenly false
    ; Header
    (box :class "panel-header"
         :orientation "h"
      (label :class "panel-title" :text "Start Focus Session")
      (button :class "close-btn"
              :onclick "eww close hyfocus-start"
        (label :text "")))

    ; Workspace selection
    (box :class "section"
         :orientation "v"
      (label :class "section-title" :text "Allowed Workspaces")
      (workspace-selector))

    ; Warning
    (box :class "warning-box"
         :orientation "h"
      (label :class "warning-icon" :text "")
      (label :class "warning-text"
             :text "Workspace switching and app launching will be blocked"))

    ; Actions
    (box :class "actions"
         :orientation "h"
         :halign "end"
         :space-evenly false
      (button :class "btn btn-secondary"
              :onclick "eww close hyfocus-start"
        "Cancel")
      (button :class "btn btn-primary"
              :onclick "scripts/hyfocus-control start ${selected-workspaces} && eww close hyfocus-start"
        "Start Focus"))))
```

**eww/styles/start-panel.scss:**
```scss
.start-panel {
  padding: 16px;
  min-width: 360px;
}

.panel-header {
  margin-bottom: 16px;

  .panel-title {
    font-size: 18px;
    font-weight: 600;
    color: $text;
    flex-grow: 1;
  }

  .close-btn {
    padding: 4px 8px;
    border-radius: 6px;
    color: $subtext0;

    &:hover {
      background: rgba($surface0, 0.5);
      color: $text;
    }
  }
}

.section {
  margin-bottom: 16px;

  .section-title {
    font-size: 12px;
    color: $subtext0;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
}

.workspace-grid {
  margin-bottom: 4px;
}

.ws-btn {
  width: 36px;
  height: 36px;
  border-radius: 8px;
  background: rgba($surface0, 0.3);
  color: $subtext0;
  font-size: 14px;
  margin: 2px;

  &:hover {
    background: rgba($surface1, 0.5);
    color: $text;
  }

  &.selected {
    background: rgba($blue, 0.3);
    color: $blue;
    border: 1px solid rgba($blue, 0.5);
  }
}

.warning-box {
  background: rgba($yellow, 0.1);
  border: 1px solid rgba($yellow, 0.2);
  border-radius: 8px;
  padding: 12px;
  margin-bottom: 16px;

  .warning-icon {
    color: $yellow;
    font-size: 16px;
    margin-right: 10px;
  }

  .warning-text {
    font-size: 13px;
    color: $subtext1;
  }
}

.actions {
  gap: 8px;
}

.btn {
  padding: 10px 20px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 500;

  &-secondary {
    background: rgba($surface0, 0.5);
    color: $subtext0;

    &:hover {
      background: rgba($surface1, 0.7);
      color: $text;
    }
  }

  &-primary {
    background: rgba($blue, 0.8);
    color: $crust;

    &:hover {
      background: $blue;
    }
  }
}
```

**Update eww/eww.yuck:**
Add includes for start panel:
```yuck
(include "widgets/workspace-selector.yuck")
(include "widgets/start-panel-widget.yuck")
(include "windows/start-panel.yuck")
```

**Update eww/eww.scss:**
Add import:
```scss
@import "styles/start-panel";
```
  </action>
  <verify>
```bash
cat eww/windows/start-panel.yuck
cat eww/widgets/start-panel-widget.yuck
cat eww/widgets/workspace-selector.yuck
cat eww/styles/start-panel.scss
test -x eww/scripts/toggle-workspace && echo "toggle script executable"
grep "start-panel" eww/eww.yuck eww/eww.scss
```
All files created and properly linked.
  </verify>
  <done>Start panel window, widgets, and styles created with workspace selection grid</done>
</task>

<task type="auto">
  <name>Task 2: Add keybind helper and README for users</name>
  <files>eww/scripts/open-start-panel, eww/README.md</files>
  <action>
**eww/scripts/open-start-panel:**
Helper script for keybind integration:
```bash
#!/bin/bash
# Open HyFocus start panel (toggle behavior)
# Usage: Add to hyprland.conf: bind = $mainMod, F, exec, ~/.config/eww/scripts/open-start-panel

EWW_CONFIG="${EWW_CONFIG:-$HOME/.config/eww}"

# Check if already open
if eww -c "$EWW_CONFIG" windows | grep -q "hyfocus-start"; then
  eww -c "$EWW_CONFIG" close hyfocus-start
else
  # Reset workspace selection to current workspace
  CURRENT_WS=$(hyprctl activeworkspace -j | jq -r '.id')
  eww -c "$EWW_CONFIG" update selected-workspaces="$CURRENT_WS"
  eww -c "$EWW_CONFIG" open hyfocus-start
fi
```

Make executable.

**eww/README.md:**
User documentation:
```markdown
# HyFocus EWW Widgets

Minimal glass-style widgets for HyFocus focus session management.

## Installation

1. **Copy to your EWW config directory:**
   ```bash
   cp -r eww/* ~/.config/eww/
   # Or to a separate location:
   mkdir -p ~/.config/eww-hyfocus
   cp -r eww/* ~/.config/eww-hyfocus/
   ```

2. **Add Hyprland layerrules for blur:**
   Add to your `hyprland.conf`:
   ```conf
   source = ~/.config/eww/hyprland-hyfocus.conf
   ```
   Or copy the contents of `hyprland-hyfocus.conf` directly.

3. **Start EWW daemon:**
   ```bash
   eww daemon
   # Or with custom config:
   eww -c ~/.config/eww-hyfocus daemon
   ```

## Usage

### Status Indicator
Shows in top-right corner when a focus session is active.
```bash
eww open hyfocus-status   # Auto-hides when inactive
eww close hyfocus-status  # Manually close
```

### Start Panel
Open the start panel to begin a focus session:
```bash
eww open hyfocus-start
# Or use the helper script:
~/.config/eww/scripts/open-start-panel
```

### Recommended Keybind
Add to `hyprland.conf`:
```conf
bind = $mainMod, F, exec, ~/.config/eww/scripts/open-start-panel
```

## Customization

### Colors
Edit `styles/_variables.scss` to change the color palette.
Default uses Catppuccin Mocha colors.

### Position
Edit window geometry in `windows/status.yuck` or `windows/start-panel.yuck`:
- Change `:anchor` for positioning (top left, top right, center, etc.)
- Adjust `:x` and `:y` offsets

### Blur Strength
In `hyprland.conf`:
```conf
decoration {
  blur {
    size = 8
    passes = 2
  }
}
```

## Requirements

- EWW 0.6.0+ (Wayland build)
- Hyprland with layerrule support
- HyFocus plugin loaded
- jq (for JSON parsing)
- Nerd Fonts (optional, for icons)
```
  </action>
  <verify>
```bash
test -x eww/scripts/open-start-panel && echo "open script executable"
cat eww/README.md | head -30
```
  </verify>
  <done>Keybind helper script and user README created</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete start panel with workspace selection, blocking warnings, and start/cancel functionality</what-built>
  <how-to-verify>
1. Update your test EWW config:
   ```bash
   cp -r eww/* ~/.config/eww-hyfocus-test/
   chmod +x ~/.config/eww-hyfocus-test/scripts/*
   ```

2. Restart EWW daemon:
   ```bash
   eww -c ~/.config/eww-hyfocus-test kill 2>/dev/null
   eww -c ~/.config/eww-hyfocus-test daemon
   ```

3. Open the start panel:
   ```bash
   eww -c ~/.config/eww-hyfocus-test open hyfocus-start
   ```

4. **Verify appearance:**
   - Panel appears centered on screen
   - Glass blur effect visible
   - "Start Focus Session" title at top
   - Close button (X) in top-right
   - Workspace grid (1-10) visible
   - Warning box with yellow accent
   - Cancel and Start Focus buttons at bottom

5. **Test workspace selection:**
   - Click workspace numbers to toggle selection
   - Selected workspaces should highlight (blue accent)
   - Multiple workspaces can be selected

6. **Test buttons:**
   - "Cancel" should close the panel
   - Re-open panel
   - Select workspaces 1 and 2
   - Click "Start Focus"
   - Panel should close AND HyFocus session should start

7. **Verify session started:**
   ```bash
   hyprctl dispatch hyfocus:status
   ```
   Should show session active with selected workspaces.

8. **Stop session:**
   ```bash
   hyprctl dispatch hyfocus:stop
   ```

9. **Test keybind helper:**
   ```bash
   ~/.config/eww-hyfocus-test/scripts/open-start-panel
   ```
   Should toggle the panel open/closed.

10. **Clean up:**
    ```bash
    eww -c ~/.config/eww-hyfocus-test close-all
    ```
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Start panel opens centered with blur effect
- [ ] Workspace selection toggles correctly
- [ ] Start button launches HyFocus session with selected workspaces
- [ ] Cancel button closes panel
- [ ] Keybind helper script works
- [ ] README provides clear user instructions
</verification>

<success_criteria>

- All tasks completed
- Full start panel workflow functional
- Phase 6 complete - EWW widgets ready for distribution
</success_criteria>

<output>
After completion, create `.planning/phases/06-eww-widget-ui/06-03-SUMMARY.md`
</output>
