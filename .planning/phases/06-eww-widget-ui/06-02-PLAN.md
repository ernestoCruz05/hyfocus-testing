---
phase: 06-eww-widget-ui
plan: 02
type: execute
domain: eww
---

<objective>
Implement minimal status indicator widget showing focus session state.

Purpose: Provide non-intrusive visual feedback when HyFocus is active - a small corner widget showing remaining time and session state.
Output: Working status indicator widget with glass styling and real-time updates.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-eww-widget-ui/06-RESEARCH.md
@eww/eww.yuck
@eww/eww.scss
@eww/scripts/hyfocus-status

**From 06-01:**
- EWW infrastructure in place
- Glass styling defined in _glass.scss
- IPC scripts ready
- Hyprland layerrules configured

**Widget requirements:**
- Minimal footprint (small, corner-positioned)
- Shows: icon + remaining time
- Different states: working (blue), break (green), paused (yellow), inactive (hidden)
- Glass aesthetic with blur
- Non-focusable (doesn't steal keyboard input)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create status indicator window and widget</name>
  <files>eww/windows/status.yuck, eww/widgets/status-widget.yuck, eww/styles/status.scss, eww/eww.yuck, eww/eww.scss</files>
  <action>
**eww/windows/status.yuck:**
Define the status indicator window:
```yuck
(defwindow hyfocus-status
  :monitor 0
  :namespace "hyfocus-status"
  :geometry (geometry
    :x "10px"
    :y "10px"
    :width "140px"
    :height "44px"
    :anchor "top right")
  :stacking "overlay"
  :exclusive false
  :focusable false
  (status-indicator))
```

Key settings:
- `:namespace "hyfocus-status"` matches Hyprland layerrule
- `:anchor "top right"` positions in corner
- `:focusable false` prevents stealing keyboard
- `:stacking "overlay"` keeps it above normal windows

**eww/widgets/status-widget.yuck:**
Define the status indicator widget:
```yuck
(defwidget status-indicator []
  (box :class "glass-panel status-container ${hyfocus-state}"
       :orientation "h"
       :space-evenly false
       :visible {hyfocus-active}
    (label :class "status-icon"
           :text {hyfocus-state == "working" ? "" :
                  hyfocus-state == "break" ? "" :
                  hyfocus-state == "paused" ? "" : ""})
    (label :class "status-time" :text hyfocus-remaining)))
```

Widget is only visible when `hyfocus-active` is true.

**Update eww/eww.yuck:**
Add includes and polling variables:
```yuck
; Variables for HyFocus state
(defpoll hyfocus-active :interval "1s"
  :initial false
  `scripts/hyfocus-status | jq -r '.active'`)

(defpoll hyfocus-state :interval "1s"
  :initial "inactive"
  `scripts/hyfocus-status | jq -r '.state'`)

(defpoll hyfocus-remaining :interval "1s"
  :initial "--:--"
  `scripts/hyfocus-status | jq -r '.remaining'`)

; Include windows and widgets
(include "widgets/status-widget.yuck")
(include "windows/status.yuck")
```

**eww/styles/status.scss:**
Style the status indicator:
```scss
.status-container {
  padding: 8px 12px;

  &.working {
    .status-icon { color: $blue; }
  }
  &.break {
    .status-icon { color: $green; }
  }
  &.paused {
    .status-icon { color: $yellow; }
  }
}

.status-icon {
  font-family: "Symbols Nerd Font", "Font Awesome 6 Free";
  font-size: 18px;
  margin-right: 8px;
}

.status-time {
  font-family: "JetBrains Mono", "Fira Code", monospace;
  font-size: 14px;
  color: $text;
}
```

**Update eww/eww.scss:**
Add import for status styles:
```scss
@import "styles/status";
```

Use Nerd Font icons:  (timer),  (coffee/break),  (pause). These are common in Hyprland setups. Fall back to text if fonts unavailable.
  </action>
  <verify>
```bash
cat eww/windows/status.yuck
cat eww/widgets/status-widget.yuck
cat eww/styles/status.scss
grep -l "status" eww/eww.yuck eww/eww.scss
```
All files exist and properly reference each other.
  </verify>
  <done>Status indicator window, widget, and styles created with polling integration</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Minimal status indicator widget with glass styling, positioned in top-right corner, showing focus state and remaining time</what-built>
  <how-to-verify>
1. Update your test EWW config:
   ```bash
   cp -r eww/* ~/.config/eww-hyfocus-test/
   ```

2. Restart EWW daemon:
   ```bash
   eww -c ~/.config/eww-hyfocus-test kill 2>/dev/null
   eww -c ~/.config/eww-hyfocus-test daemon
   ```

3. Open the status window:
   ```bash
   eww -c ~/.config/eww-hyfocus-test open hyfocus-status
   ```

4. **Without HyFocus active:** Widget should be hidden (not visible)

5. **Start a HyFocus session:**
   ```bash
   hyprctl dispatch hyfocus:start 1
   ```

6. **Verify widget appears:**
   - Should show in top-right corner
   - Glass/blur effect visible (semi-transparent with blurred background)
   - Shows timer icon and countdown (e.g., "25:00")
   - Updates every second

7. **Test states:**
   - `hyprctl dispatch hyfocus:pause` - Icon should change to pause
   - `hyprctl dispatch hyfocus:resume` - Icon back to timer
   - `hyprctl dispatch hyfocus:stop` - Widget should disappear

8. **Close test window:**
   ```bash
   eww -c ~/.config/eww-hyfocus-test close hyfocus-status
   ```

If blur not working, ensure hyprland-hyfocus.conf layerrules are sourced in your hyprland.conf.
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Status window opens without errors
- [ ] Widget shows/hides based on HyFocus active state
- [ ] Timer countdown updates in real-time
- [ ] Glass blur effect visible (requires Hyprland layerrules)
- [ ] Different icons for working/break/paused states
</verification>

<success_criteria>

- All tasks completed
- Status indicator displays correctly with blur
- Real-time updates working
- Ready for start panel in plan 06-03
</success_criteria>

<output>
After completion, create `.planning/phases/06-eww-widget-ui/06-02-SUMMARY.md`
</output>
